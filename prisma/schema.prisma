// Prisma schema for Millan Luxury Cleaning

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id              String   @id
  email           String?  @unique
  firstName       String?
  lastName        String?
  profileImageUrl String?
  isAdmin         Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("users")
}

model Session {
  sid    String   @id
  sess   Json
  expire DateTime

  @@index([expire])
  @@map("sessions")
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  service   String
  message   String
  timestamp DateTime @default(now())

  @@map("contact_messages")
}

model GalleryItem {
  id                  Int      @id @default(autoincrement())
  title               String
  category            String
  imageUrl            String?
  imagePublicId       String?
  imageFilename       String?
  imageMetadata       Json?
  beforeImageUrl      String?
  beforeImagePublicId String?
  beforeImageFilename String?
  beforeImageMetadata Json?
  afterImageUrl       String?
  afterImagePublicId  String?
  afterImageFilename  String?
  afterImageMetadata  Json?
  order               Int      @default(0)
  createdAt           DateTime @default(now())

  @@map("gallery_items")
}

model ServiceItem {
  id            Int      @id @default(autoincrement())
  title         String
  description   String
  iconUrl       String?
  imageUrl      String?
  iconMetadata  Json?
  imageMetadata Json?
  createdAt     DateTime @default(now())

  // Legacy compatibility
  name     String?
  features String[] @default([])
  order    Int      @default(0)

  // New fields for pricing and visibility
  price         Decimal? @db.Decimal(10, 2)
  displayPrice  Boolean  @default(false)
  isVisible     Boolean  @default(true)

  @@index([isVisible])
  @@map("services")
}

model Testimonial {
  id        Int      @id @default(autoincrement())
  author    String
  rating    Int
  content   String
  createdAt DateTime @default(now())

  // Legacy compatibility
  name      String?
  review    String?
  source    String?
  sourceUrl String?
  order     Int     @default(0)

  // Google OAuth integration
  externalId String?
  isApproved Boolean  @default(true)  // Existing testimonials stay approved
  importedAt DateTime?

  // Composite unique constraint for external reviews
  @@unique([source, externalId], name: "testimonial_source_external_id")
  @@map("testimonials")
}

model FaqItem {
  id        Int      @id @default(autoincrement())
  question  String
  answer    String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  isVisible Boolean  @default(true)

  @@index([isVisible])
  @@map("faqs")
}

model BrandingAsset {
  id                 Int      @id @default(autoincrement())
  logoUrl            String?
  heroCrownUrl       String?
  backgroundUrl      String?
  logoMetadata       Json?
  heroCrownMetadata  Json?
  backgroundMetadata Json?
  updatedAt          DateTime @updatedAt

  @@map("branding_assets")
}

model SiteAsset {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  url         String
  name        String?
  filename    String?
  publicId    String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("site_assets")
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  slug      String   @unique
  excerpt   String
  body      String
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("posts")
}

model OAuthToken {
  id           Int      @id @default(autoincrement())
  service      String   @unique  // "google"
  accessToken  String   // Encrypted
  refreshToken String?  // Encrypted
  expiresAt    DateTime
  createdAt    DateTime @default(now())

  @@map("oauth_tokens")
}

model FragranceProduct {
  id           Int      @id @default(autoincrement())
  name         String
  description  String
  category     String   // "candle-3wick", "car-diffuser", etc.
  fragrance    String   // "Bell", "Golden Hour", etc.
  price        Decimal  @db.Decimal(10, 2)
  salePrice    Decimal? @db.Decimal(10, 2)
  displayPrice Boolean  @default(true)
  isVisible    Boolean  @default(true)
  imageUrl     String?
  squareUrl    String
  sku          String?  @unique
  featured     Boolean  @default(false)
  order        Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category])
  @@index([fragrance])
  @@index([featured])
  @@index([isVisible])
  @@map("fragrance_products")
}
