generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id              String   @id
  email           String?  @unique
  firstName       String?
  lastName        String?
  profileImageUrl String?
  isAdmin         Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("users")
}

model Session {
  sid    String   @id
  sess   Json
  expire DateTime

  @@index([expire])
  @@map("sessions")
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  service   String
  message   String
  timestamp DateTime @default(now())

  @@map("contact_messages")
}

model GalleryItem {
  id                  Int      @id @default(autoincrement())
  title               String
  category            String
  imageUrl            String?
  imagePublicId       String?
  imageFilename       String?
  imageMetadata       Json?
  beforeImageUrl      String?
  beforeImagePublicId String?
  beforeImageFilename String?
  beforeImageMetadata Json?
  afterImageUrl       String?
  afterImagePublicId  String?
  afterImageFilename  String?
  afterImageMetadata  Json?
  order               Int      @default(0)
  createdAt           DateTime @default(now())

  @@map("gallery_items")
}

model ServiceItem {
  id            Int      @id @default(autoincrement())
  title         String
  description   String
  iconUrl       String?
  imageUrl      String?
  iconMetadata  Json?
  imageMetadata Json?
  createdAt     DateTime @default(now())
  name          String?
  features      String[] @default([])
  order         Int      @default(0)
  displayPrice  Boolean  @default(false)
  isVisible     Boolean  @default(true)
  price         Decimal? @db.Decimal(10, 2)
  squareServiceId     String?
  squareTeamMemberIds String[] @default([])
  duration            Int      @default(60)

  @@index([isVisible])
  @@map("services")
}

model Testimonial {
  id         Int       @id @default(autoincrement())
  author     String
  rating     Int
  content    String
  createdAt  DateTime  @default(now())
  name       String?
  review     String?
  source     String?
  sourceUrl  String?
  order      Int       @default(0)
  externalId String?
  importedAt DateTime?
  isApproved Boolean   @default(true)

  @@unique([source, externalId], name: "testimonial_source_external_id")
  @@map("testimonials")
}

model FaqItem {
  id        Int      @id @default(autoincrement())
  question  String
  answer    String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  isVisible Boolean  @default(true)

  @@index([isVisible])
  @@map("faqs")
}

model SiteAsset {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  url         String
  name        String?
  filename    String?
  publicId    String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("site_assets")
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  slug      String   @unique
  excerpt   String
  body      String
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("posts")
}

model OAuthToken {
  id           Int      @id @default(autoincrement())
  service      String   @unique
  provider     String   @default("google")
  merchantId   String?
  locationId   String?
  payload      Json?
  accessToken  String
  refreshToken String?
  expiresAt    DateTime
  createdAt    DateTime @default(now())

  @@unique([provider, merchantId])
  @@map("oauth_tokens")
}

model SquareConfig {
  id               Int      @id @default(autoincrement())
  accessToken      String
  refreshToken     String?
  merchantId       String
  locationId       String
  applicationId    String
  environment      String
  webhookSignature String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@map("square_config")
}

model Cart {
  id        String     @id @default(cuid())
  sessionId String?
  userId    String?
  items     CartItem[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  expiresAt DateTime

  @@map("carts")
}

model CartItem {
  id        Int      @id @default(autoincrement())
  cartId    String
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  productId Int
  quantity  Int      @default(1)
  price     Decimal  @db.Decimal(10, 2)
  createdAt DateTime @default(now())

  @@map("cart_items")
}

model Order {
  id              Int         @id @default(autoincrement())
  squareOrderId   String      @unique
  userId          String?
  email           String
  status          String      @default("pending")
  total           Decimal     @db.Decimal(10, 2)
  subtotal        Decimal     @db.Decimal(10, 2)
  tax             Decimal?    @db.Decimal(10, 2)
  items           OrderItem[]
  shippingAddress Json?
  billingAddress  Json?
  paymentId       String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@map("orders")
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId Int
  name      String
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  sku       String?

  @@map("order_items")
}

model Booking {
  id              Int      @id @default(autoincrement())
  squareBookingId String   @unique
  customerId      String?
  customerEmail   String
  customerName    String
  customerPhone   String?
  serviceId       Int
  teamMemberId    String?
  startAt         DateTime
  endAt           DateTime
  status          String   @default("pending")
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("bookings")
}

model InventorySync {
  id           Int      @id @default(autoincrement())
  locationId   String?
  status       String   @default("pending")
  startedAt    DateTime @default(now())
  completedAt  DateTime?
  errorMessage String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("inventory_sync")
}

model FragranceProduct {
  id           Int      @id @default(autoincrement())
  name         String
  description  String
  category     String
  fragrance    String
  price        Decimal  @db.Decimal(10, 2)
  salePrice    Decimal? @db.Decimal(10, 2)
  displayPrice Boolean  @default(true)
  isVisible    Boolean  @default(true)
  imageUrl     String?
  squareUrl    String
  squareCatalogId   String?
  squareItemId      String?
  squareVariationId String?
  sku          String?  @unique
  inventoryCount    Int      @default(0)
  lowStockThreshold Int      @default(5)
  trackInventory    Boolean  @default(false)
  featured     Boolean  @default(false)
  order        Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category])
  @@index([fragrance])
  @@index([featured])
  @@index([isVisible])
  @@map("fragrance_products")
}
